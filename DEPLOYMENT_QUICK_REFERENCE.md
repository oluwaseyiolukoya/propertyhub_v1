# Verification Service Deployment - Quick Reference

**Date:** November 26, 2025  
**Status:** âœ… CODE PUSHED TO GITHUB

---

## ðŸŽ¯ What Was Pushed

### **Commits:**
1. `feat(database): add KYC verification schema and migrations`
   - Main backend KYC schema changes
   - Verification service database schema
   - All migrations

2. `feat(kyc): implement identity verification microservice and KYC flow`
   - Complete verification microservice
   - KYC frontend components
   - Admin verification management
   - Email search functionality
   - Document view/download

---

## ðŸš€ Quick Deployment Steps

### **1. Run Deployment Helper Script**
```bash
./deploy-verification-service.sh
```

This will:
- Generate security keys (ENCRYPTION_KEY, API_KEY)
- Help create PostgreSQL database
- Help create Redis database
- Generate environment variables template

### **2. Create App in DigitalOcean**

**Go to:** https://cloud.digitalocean.com/apps

**Settings:**
- **Repository:** `oluwaseyiolukoya/propertyhub_v1`
- **Branch:** `main`
- **Source Directory:** `/verification-service`
- **Build Command:** `npm ci && npx prisma generate && npm run build`
- **Run Command:** `npm run start`
- **HTTP Port:** `8080`
- **Health Check:** `/health`
- **Instance Size:** Basic (512 MB) - $12/month

### **3. Add Environment Variables**

Copy from `verification-service-env-vars.txt` (generated by script)

**Required:**
- `DATABASE_URL` - From verification database
- `REDIS_URL` - From Redis database
- `SPACES_ACCESS_KEY_ID` - From existing Spaces
- `SPACES_SECRET_ACCESS_KEY` - From existing Spaces
- `DOJAH_API_KEY` - From Dojah dashboard
- `DOJAH_APP_ID` - From Dojah dashboard
- `ENCRYPTION_KEY` - Generated by script
- `API_KEY_MAIN_DASHBOARD` - Generated by script
- `MAIN_DASHBOARD_URL` - Your main backend URL

### **4. Deploy and Run Migrations**

```bash
# After app is deployed, connect to verification database
export DATABASE_URL="postgresql://..."

# Run migrations
cd verification-service
npx prisma migrate deploy

# Seed API key
npx prisma db seed
```

### **5. Update Main Backend**

Add to main backend environment variables:
```
VERIFICATION_SERVICE_URL=https://verification-service-xxxxx.ondigitalocean.app
VERIFICATION_API_KEY=<same-as-API_KEY_MAIN_DASHBOARD>
```

Redeploy main backend.

### **6. Test**

```bash
# Health check
curl https://verification-service-xxxxx.ondigitalocean.app/health

# Expected: {"status":"ok",...}
```

---

## ðŸ’° Cost Summary

**New Monthly Costs:**
- Verification Service App: $12
- PostgreSQL Database: $15
- Redis Database: $15
- **Total NEW:** $42/month

**Total All Services:** ~$74/month

---

## ðŸ“‹ Checklist

### **Pre-Deployment:**
- [x] Code pushed to GitHub
- [x] Migrations committed
- [ ] Dojah API credentials obtained
- [ ] DigitalOcean CLI installed (`doctl`)

### **Deployment:**
- [ ] Run `./deploy-verification-service.sh`
- [ ] Create verification database
- [ ] Create Redis database
- [ ] Create App Platform service
- [ ] Add environment variables
- [ ] Deploy app
- [ ] Run migrations
- [ ] Seed API key

### **Post-Deployment:**
- [ ] Health check passes
- [ ] Update main backend
- [ ] Test KYC flow
- [ ] Test admin verification
- [ ] Test document upload/download
- [ ] Configure monitoring
- [ ] Set up alerts

---

## ðŸ”— Important Links

- **Deployment Guide:** [VERIFICATION_SERVICE_DEPLOYMENT_GUIDE.md](VERIFICATION_SERVICE_DEPLOYMENT_GUIDE.md)
- **Testing Guide:** [VERIFICATION_SERVICE_TESTING_GUIDE.md](VERIFICATION_SERVICE_TESTING_GUIDE.md)
- **DigitalOcean Console:** https://cloud.digitalocean.com
- **GitHub Repository:** https://github.com/oluwaseyiolukoya/propertyhub_v1

---

## ðŸ†˜ Quick Troubleshooting

### **Build Fails:**
```bash
# Check build logs
doctl apps logs <app-id> --type build

# Common issues:
# - Missing dependencies in package.json
# - TypeScript errors
# - Prisma generate failed
```

### **Health Check Fails:**
```bash
# Check runtime logs
doctl apps logs <app-id> --type run

# Common issues:
# - DATABASE_URL incorrect
# - REDIS_URL incorrect
# - Port mismatch (must be 8080)
```

### **Can't Upload Documents:**
```bash
# Check Spaces credentials
# Verify SPACES_ACCESS_KEY_ID and SPACES_SECRET_ACCESS_KEY

# Test Spaces connection
cd verification-service
node test-spaces-connection.js
```

---

## ðŸ“ž Support

**Documentation:**
- Full deployment guide: `VERIFICATION_SERVICE_DEPLOYMENT_GUIDE.md`
- Architecture details: `KYC_DOCUMENT_STORAGE_ARCHITECTURE.md`
- Testing guide: `VERIFICATION_SERVICE_TESTING_GUIDE.md`

**Need Help?**
- Check DigitalOcean docs: https://docs.digitalocean.com/products/app-platform/
- Check Prisma docs: https://www.prisma.io/docs/
- Check BullMQ docs: https://docs.bullmq.io/

---

**Last Updated:** November 26, 2025  
**Deployment Time:** ~2-3 hours  
**Status:** âœ… READY TO DEPLOY

