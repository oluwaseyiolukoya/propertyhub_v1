# Environment Variables Setup Checklist

**Date:** November 26, 2025  
**For:** Verification Service Deployment with Upstash Redis

---

## üìã Step-by-Step Environment Setup

### **Step 1: Get DigitalOcean Database Connection String**

1. **Go to DigitalOcean Console:**
   ```
   https://cloud.digitalocean.com/databases
   ```

2. **Click on:** `verification-db-prod` (the database you just created)

3. **Go to:** "Connection Details" tab

4. **Copy:** "Connection String" (should look like):
   ```
   postgresql://doadmin:AVNS_xyz123@verification-db-prod-do-user-123456-0.b.db.ondigitalocean.com:25060/defaultdb?sslmode=require
   ```

5. **Paste into:** `verification-service-env-vars-upstash.txt` ‚Üí `DATABASE_URL`

---

### **Step 2: Get Upstash Redis Connection String**

1. **Go to Upstash Dashboard:**
   ```
   https://console.upstash.com/
   ```

2. **Click on:** Your database (`verification-redis-prod`)

3. **Scroll down to:** "Connect your database" section

4. **Click on:** "Node.js" or "Redis URL" tab

5. **Copy:** The full connection string (looks like):
   ```
   redis://default:AXbCD1234567890abcdefghijklmnopqrstuvwxyz@us1-merry-firefly-12345.upstash.io:6379
   ```

6. **Paste into:** `verification-service-env-vars-upstash.txt` ‚Üí `REDIS_URL`

---

### **Step 3: Get DigitalOcean Spaces Credentials**

**Option A: Use Existing Spaces Keys (Recommended)**

1. **Check your main backend environment variables:**
   ```bash
   # In DigitalOcean App Platform
   # Go to: Your Backend App ‚Üí Settings ‚Üí Environment Variables
   # Look for:
   # - SPACES_ACCESS_KEY_ID (or AWS_ACCESS_KEY_ID)
   # - SPACES_SECRET_ACCESS_KEY (or AWS_SECRET_ACCESS_KEY)
   ```

2. **Copy the same keys** to verification service

**Option B: Create New Spaces Keys**

1. **Go to DigitalOcean Console:**
   ```
   https://cloud.digitalocean.com/account/api/spaces
   ```

2. **Click:** "Generate New Key"

3. **Name:** `verification-service-spaces-key`

4. **Copy:**
   - Access Key ID (like: `DO00ABC123XYZ456`)
   - Secret Access Key (like: `abc123def456...`)

5. **‚ö†Ô∏è IMPORTANT:** Save the secret key immediately - you can't view it again!

6. **Paste into:** `verification-service-env-vars-upstash.txt`
   - `SPACES_ACCESS_KEY_ID`
   - `SPACES_SECRET_ACCESS_KEY`

---

### **Step 4: Get Dojah API Credentials**

1. **Go to Dojah:**
   ```
   https://dojah.io/
   ```

2. **Sign up / Log in**

3. **Go to Dashboard:**
   ```
   https://dashboard.dojah.io/
   ```

4. **Navigate to:** "API Keys" or "Settings" ‚Üí "API Keys"

5. **Copy:**
   - **API Key** (looks like: `test_sk_abc123def456...` for test mode)
   - **App ID** (looks like: `app_xyz789abc123`)

6. **Paste into:** `verification-service-env-vars-upstash.txt`
   - `DOJAH_API_KEY`
   - `DOJAH_APP_ID`

**Note:** Use **TEST** keys for development, **LIVE** keys for production.

---

### **Step 5: Generate Security Keys**

These were already generated by the `deploy-verification-service.sh` script.

**If you need to generate them manually:**

```bash
# Generate ENCRYPTION_KEY (32 bytes = 64 hex characters)
openssl rand -hex 32

# Generate API_KEY_MAIN_DASHBOARD
echo "vkey_$(openssl rand -hex 24)"
```

**Paste into:** `verification-service-env-vars-upstash.txt`
- `ENCRYPTION_KEY`
- `API_KEY_MAIN_DASHBOARD`

---

### **Step 6: Get Main Backend URL**

1. **Go to DigitalOcean App Platform:**
   ```
   https://cloud.digitalocean.com/apps
   ```

2. **Click on:** Your main backend app

3. **Copy:** The "Live URL" (looks like):
   ```
   https://clownfish-app-mh6k4.ondigitalocean.app
   ```

4. **Paste into:** `verification-service-env-vars-upstash.txt` ‚Üí `MAIN_DASHBOARD_URL`

---

## ‚úÖ Final Environment Variables File

Your `verification-service-env-vars-upstash.txt` should look like:

```bash
NODE_ENV=production
PORT=8080

# Database
DATABASE_URL=postgresql://doadmin:AVNS_xyz@verification-db-prod-do-user-123.b.db.ondigitalocean.com:25060/defaultdb?sslmode=require

# Redis (Upstash)
REDIS_URL=redis://default:AXbCD1234567890abcdefghijklmnopqrstuvwxyz@us1-merry-firefly-12345.upstash.io:6379

# DigitalOcean Spaces
SPACES_ACCESS_KEY_ID=DO00ABC123XYZ456
SPACES_SECRET_ACCESS_KEY=your-secret-key-32-chars
SPACES_REGION=nyc3
SPACES_BUCKET=contrezz-uploads
SPACES_ENDPOINT=https://nyc3.digitaloceanspaces.com

# Dojah API
DOJAH_API_KEY=test_sk_abc123def456ghi789
DOJAH_APP_ID=app_xyz789abc123

# Security
ENCRYPTION_KEY=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
API_KEY_MAIN_DASHBOARD=vkey_abc123def456ghi789jkl012mno345pqr678stu901vwx234

# Main Dashboard
MAIN_DASHBOARD_URL=https://clownfish-app-mh6k4.ondigitalocean.app
```

---

## üéØ Next Steps: Add to DigitalOcean App Platform

### **Method 1: During App Creation (Recommended)**

When creating the app in DigitalOcean:

1. **After configuring build/run commands**
2. **Click:** "Environment Variables" section
3. **For each variable:**
   - Click "Add Variable"
   - **Key:** (e.g., `DATABASE_URL`)
   - **Value:** (paste the value)
   - **Encrypt:** ‚úÖ Check this for sensitive values:
     - `DATABASE_URL`
     - `REDIS_URL`
     - `SPACES_SECRET_ACCESS_KEY`
     - `DOJAH_API_KEY`
     - `ENCRYPTION_KEY`
     - `API_KEY_MAIN_DASHBOARD`

4. **Add all 16 environment variables**

5. **Click:** "Create Resources"

---

### **Method 2: After App Creation**

If app is already created:

1. **Go to:** Your verification service app in DigitalOcean

2. **Click:** "Settings" tab

3. **Scroll to:** "App-Level Environment Variables"

4. **Click:** "Edit"

5. **Add each variable:**
   - Click "Add Variable"
   - Enter Key and Value
   - Check "Encrypt" for sensitive values
   - Click "Save"

6. **Click:** "Save" at the bottom

7. **Redeploy:** The app will automatically redeploy with new variables

---

## üß™ Verify Environment Variables

After deployment, check if variables are loaded:

```bash
# View app logs
doctl apps logs <your-app-id> --type run

# Look for these lines:
# ‚úÖ Environment variables loaded
# ‚úÖ Database connection: ok
# ‚úÖ Redis connection: ok
# ‚úÖ Spaces configuration: ok
```

---

## üîí Security Best Practices

### **Variables to ALWAYS Encrypt:**
- ‚úÖ `DATABASE_URL` (contains password)
- ‚úÖ `REDIS_URL` (contains password)
- ‚úÖ `SPACES_SECRET_ACCESS_KEY` (secret key)
- ‚úÖ `DOJAH_API_KEY` (API secret)
- ‚úÖ `ENCRYPTION_KEY` (encryption secret)
- ‚úÖ `API_KEY_MAIN_DASHBOARD` (API secret)

### **Variables OK to Leave Unencrypted:**
- `NODE_ENV`
- `PORT`
- `SPACES_REGION`
- `SPACES_BUCKET`
- `SPACES_ENDPOINT`
- `SPACES_ACCESS_KEY_ID` (public key)
- `DOJAH_APP_ID` (public ID)
- `MAIN_DASHBOARD_URL`

---

## üìù Checklist

- [ ] DATABASE_URL filled in (from DigitalOcean database)
- [ ] REDIS_URL filled in (from Upstash)
- [ ] SPACES_ACCESS_KEY_ID filled in
- [ ] SPACES_SECRET_ACCESS_KEY filled in
- [ ] SPACES_REGION set to `nyc3`
- [ ] SPACES_BUCKET set to `contrezz-uploads`
- [ ] SPACES_ENDPOINT set to `https://nyc3.digitaloceanspaces.com`
- [ ] DOJAH_API_KEY filled in
- [ ] DOJAH_APP_ID filled in
- [ ] ENCRYPTION_KEY generated (64 hex chars)
- [ ] API_KEY_MAIN_DASHBOARD generated (starts with `vkey_`)
- [ ] MAIN_DASHBOARD_URL filled in (your backend URL)
- [ ] NODE_ENV set to `production`
- [ ] PORT set to `8080`
- [ ] All sensitive values marked as "Encrypt" in DigitalOcean
- [ ] Environment variables added to App Platform

---

## üéØ Quick Test

After adding environment variables and deploying:

```bash
# Test health endpoint
curl https://your-verification-service.ondigitalocean.app/health

# Expected response:
{
  "status": "ok",
  "timestamp": "2025-11-26T...",
  "uptime": 123.456,
  "service": "verification-service",
  "version": "1.0.0",
  "dependencies": {
    "database": "ok",
    "redis": "ok"
  }
}
```

If you see `"database": "ok"` and `"redis": "ok"`, everything is configured correctly! ‚úÖ

---

**Last Updated:** November 26, 2025  
**Status:** ‚úÖ READY TO USE WITH UPSTASH REDIS

